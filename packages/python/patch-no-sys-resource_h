--- Modules/_lsprof.c
+++ Modules/_lsprof.c
@@ -36,7 +36,9 @@
 #error "This module requires gettimeofday() on non-Windows platforms!"
 #endif
 
+#ifdef HAVE_RESOURCE_H
 #include <sys/resource.h>
+#endif
 #include <sys/times.h>
 
 static PY_LONG_LONG
--- Modules/resource.c
+++ Modules/resource.c
@@ -1,5 +1,8 @@
 
 #include "Python.h"
+
+#ifdef HAVE_SYS_RESOURCE_H
+
 #include <sys/resource.h>
 #include <sys/time.h>
 #include <string.h>
@@ -452,3 +455,5 @@
     initialized = 1;
     return m;
 }
+
+#endif /* HAVE_SYS_RESOURCE_H */
