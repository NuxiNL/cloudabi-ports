--- Modules/socketmodule.c
+++ Modules/socketmodule.c
@@ -4829,6 +4829,7 @@
 };
 
 
+#if defined(MS_WINDOWS) || defined(HAVE_GETHOSTNAME)
 /* Python interface to gethostname(). */
 
 /*ARGSUSED*/
@@ -4888,6 +4889,7 @@
 "gethostname() -> string\n\
 \n\
 Return the current host name.");
+#endif /* defined(MS_WINDOWS) || defined(HAVE_GETHOSTNAME) */
 
 #ifdef HAVE_SETHOSTNAME
 PyDoc_STRVAR(sethostname_doc,
@@ -4926,6 +4928,7 @@
 }
 #endif
 
+#if defined(HAVE_GETHOSTBYNAME)
 /* Python interface to gethostbyname(name). */
 
 /*ARGSUSED*/
@@ -4950,6 +4953,7 @@
 "gethostbyname(host) -> address\n\
 \n\
 Return the IP address (a string of the form '255.255.255.255') for a host.");
+#endif /* defined(HAVE_GETHOSTBYNAME) */
 
 
 static PyObject*
@@ -4965,6 +4969,7 @@
 #endif
 }
 
+#if defined(HAVE_GETHOSTBYNAME) || defined(HAVE_GETHOSTBYADDR)
 /* Convenience function common to gethostbyname_ex and gethostbyaddr */
 
 static PyObject *
@@ -5094,8 +5099,10 @@
     Py_XDECREF(addr_list);
     return rtn_tuple;
 }
+#endif /* defined(HAVE_GETHOSTBYNAME) || defined(HAVE_GETHOSTBYADDR) */
 
 
+#if defined(HAVE_GETHOSTBYNAME)
 /* Python interface to gethostbyname_ex(name). */
 
 /*ARGSUSED*/
@@ -5164,8 +5171,10 @@
 \n\
 Return the true host name, a list of aliases, and a list of IP addresses,\n\
 for a host.  The host argument is a string giving a host name or IP number.");
+#endif /* defined(HAVE_GETHOSTBYNAME) */
 
 
+#if defined(HAVE_GETHOSTBYADDR)
 /* Python interface to gethostbyaddr(IP). */
 
 /*ARGSUSED*/
@@ -5256,6 +5265,7 @@
 \n\
 Return the true host name, a list of aliases, and a list of IP addresses,\n\
 for a host.  The host argument is a string giving a host name or IP number.");
+#endif /* defined(HAVE_GETHOSTBYADDR) */
 
 
 /* Python interface to getservbyname(name).
@@ -6355,14 +6365,20 @@
 /* List of functions exported by this module. */
 
 static PyMethodDef socket_methods[] = {
+#ifdef HAVE_GETHOSTBYNAME
     {"gethostbyname",           socket_gethostbyname,
      METH_VARARGS, gethostbyname_doc},
     {"gethostbyname_ex",        socket_gethostbyname_ex,
      METH_VARARGS, ghbn_ex_doc},
+#endif
+#ifdef HAVE_GETHOSTBYADDR
     {"gethostbyaddr",           socket_gethostbyaddr,
      METH_VARARGS, gethostbyaddr_doc},
+#endif
+#if defined(MS_WINDOWS) || defined(HAVE_GETHOSTNAME)
     {"gethostname",             socket_gethostname,
      METH_NOARGS,  gethostname_doc},
+#endif
 #ifdef HAVE_SETHOSTNAME
     {"sethostname",             socket_sethostname,
      METH_VARARGS,  sethostname_doc},
